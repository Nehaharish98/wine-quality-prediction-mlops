# Azure Container App deployment configuration
apiVersion: 2023-05-01
type: Microsoft.App/containerApps
name: wine-api
properties:
  managedEnvironmentId: ${CONTAINER_APP_ENVIRONMENT_ID}
  configuration:
    activeRevisionsMode: single
    ingress:
      external: true
      targetPort: 8000
      allowInsecure: false
      traffic:
        - weight: 100
          latestRevision: true
    registries:
      - server: ${ACR_LOGIN_SERVER}
        username: ${ACR_USERNAME}
        passwordSecretRef: registry-password
    secrets:
      - name: registry-password
        value: ${ACR_PASSWORD}
  template:
    containers:
      - name: wine-pred
        image: ${ACR_LOGIN_SERVER}/wine-pred:latest
        resources:
          cpu: 0.25
          memory: 0.5Gi
        env:
          - name: MLFLOW_TRACKING_URI
            value: "http://localhost:5000"
    scale:
      minReplicas: 0
      maxReplicas: 3